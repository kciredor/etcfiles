These are my /etc config files.

Applies to my new setup with Arch Linux (single boot) on a Macbook Pro retina, 2012 (10.1) model.
Under active development whilst trying to accomplish a properly working linux install.

The install_deps folder assumes kernel 3.16, you need to build the files yourself if you have a more recent install iso.



** Arch single boot install on a MacBook Pro Retina, mid 2012, model 10.1 **

Pre reqs:
0. Backup Mac home folder on a FAT disk, with split up tar files 1GB each + Backup entire disk with TimeMachine + Mute sound in Mac OS
1. USB Stick with Arch install
2. USB Stick with b43 drivers (could try broadcom-wl as well for your AP) <- drivers need compilation
3. Boot Arch install
4. loadkeys dvorak
5. WiFi:

modprobe -r b43 bcma
mkdir /tmp/usb
mount /dev/sdc1 /tmp/usb 
cp -R /tmp/usb/b43 /usr/lib/firmware
modprobe b43
wpa_passphrase YOUR_SSID password >/etc/wpa_supplicant/wpa_supplicant.conf
wpa_supplicant -B -i wlp4s0 -c /etc/wpa_supplicant/wpa_supplicant.conf
dhcpcd wlp4s0
umount /tmp/usb && rm -r /tmp/usb

6. Partition:

cfdisk

/dev/sda1 200M Microsoft basic data
/dev/sda2 256M Linux filesystem
/dev/sda3 <remainder> Linux LVM

cryptsetup luksFormat /dev/sda3
cryptsetup open --type luks /dev/sda3 lvm
pvcreate /dev/mapper/lvm
vgcreate MyStorage /dev/mapper/lvm
lvcreate -L 16G MyStorage -n swapvol    (16G equals RAM, for hibernate-to-disk)
lvcreate -l +100%FREE MyStorage -n rootvol

mkfs.ext4 /dev/mapper/mystorage-rootvol
mkswap /dev/mapper/MyStorage-swapvol
mkfs.vfat -F 32 /dev/sda1
mkfs.ext2 /dev/sda2

mount /dev/MyStorage/rootvol /mnt
swapon /dev/MyStorage/swapvol
mkdir /mnt/boot
mount /dev/sda2 /mnt/boot
mkdir /mnt/boot/efi
mount /dev/sda1 /mnt/boot/efi

7. Follow the Arch beginners guide install:

nano /etc/pacman.d/mirrorlist (put your nearest mirror on top)
pacstrap -i /mnt base base-devel (all)
genfstab -U -p /mnt >>/mnt/etc/fstab
nano /mnt/etc/fstab -> add 'discard' to all partitions
arch-chroot /mnt /bin/bash
nano /etc/locale.gen -> en_US.UTF-8 UTF-8
locale-gen
echo LANG=en_US.UTF-8 > /etc/locale.conf
export LANG=en_US.UTF-8
nano /etc/vconsole.conf -> KEYMAP=dvorak and FONT=sun12x22
nano /etc/modprobe.d/hid_apple.conf -> options hid_apple fnmode=2
ln -s /usr/share/zoneinfo/Europe/Amsterdam /etc/localtime
hwclock --systohc --utc
echo kciredor > /etc/hostname
nano /etc/hosts: add 127.0.1.1 kciredor.localdomain kciredor
pacman -S iw wpa_supplicant vim dkms linux-headers dialog
nano /etc/mkinitcpio.conf -> add encrypt lvm2 (before filesystems in HOOKS= line)
mkinitcpio -p linux
nano /etc/default/grub -> add cryptdevice=/dev/sda3:MyStorage to GRUB_CMDLINE_LINUX
passwd

8. Bootloader:

pacman -S grub-efi-x86_64 efibootmgr
mount -t efivarfs efivarfs /sys/firmware/efi/efivars (gives error: busy, already mounted)
grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=grub --recheck --debug
gruk-mkconfig -o /boot/efi/EFI/grub/grub.cfg
cp /boot/efi/EFI/grub/grub.cfg /boot/grub/grub.cfg
cp /boot/efi/EFI/grub/grubx64.efi /boot/efi/EFI/bootx64.efi

exit
umount -R /mnt
reboot

You should now have an instant and proper Arch boot!

9. First boot:

useradd -g wheel -G video,audio,lp kciredor ; passwd kciredor
pacman -S xorg xorg-xinit awesome (first mesa option)

# use swap just for hibernate (better for SSD)
echo 1 > /proc/sys/vm/swappiness

# restore home folder backup from fat disk:
mount /dev/sdb4 ext
cat ../ext/* | tar xfv -
umount /dev/sdb4

# Use the improved driver supporting just about any AP incl. 5Ghz: broadcom-wl
sudo pacman -U broadcom-dkms-x.tgz
Add 'wl' to /etc/modules-load.d and make sure there's a b43 blocklist in /etc/modprobe.d by now.
sudo pacman -S wpa_actiond
sudo pacman -S ifplugd
sudo systemctl enable netctl-ifplugd@enp0s20u2.service
sudo systemctl enable netctl-auto@wlp4s0.service

Create a wired-dhcp profile in /etc/netctl
Create wifi-profiles using wifi-menu.

10. Basics

pacman -S openssh git autojump virtualbox qt4 nfs-tools net-tools
vim /etc/modules-load.d/virtualbox.conf -> vboxdrv, vboxnetadp, vboxnetflt, vboxpic
..etc etc etc

11. Hibernate

Run mkinitcpio -p linux after dropping my etcfiles mkinitcpio.conf with hibernate support: resume in HOOKS
Run grub-mkconfig -o /boot/grub/grub.cfg after adding GRUB_CMDLINE_LINUX_DEFAULT="intremap=off irqpoll quiet elevator=noop resume=/dev/disk/by-uuid/YOUR_SWAP_DISK_UUID" (elevator=noop is good for SSD)
Now systemctl hibernate works (assuming you have enough swap space)

12. Notes

Dropbox: AUR, systemctl enable dropbox@username, run once via /opt/dropbox/dropbox to setup; update the sytemctl script to get a systemtray icon
Spotify: AUR
Sound: https://wiki.archlinux.org/index.php/Bose_speakers
CrashPlan: AUR

# Survived the first kernel upgrade from 3.16 to 3.17:
sudo pacman -Syu (upgrades kernel and everything)
sudo yaourt -Syua (this fixes the broadcom wl module <- yes you need to be wired connected)
reboot

In case of no update for broadcom, fix like this:
    sudo pacman -Q broadcom-wl-dkms
    sudo dkms remove broadcom-wl/6.30.223.248 --all
    sudo dkms add broadcom-wl/6.30.223.248 --all
    sudo dkms build broadcom-wl/6.30.223.248 --all
    sudo dkms install broadcom-wl/6.30.223.248 --all
    sudo systemctl restart dkms.service
    sudo modprobe wl

13. Printer

sudo pacman -S cups ghostscript gsfonts hplib libcups python-gobject python-dbus python-pyqt4
yaourt -Sa hplip-plugin

sudo systemctl enable org.cups.cupsd.service
sudo systemctl start org.cups.cupsd.service

sudo hp-setup -i (or -u with python-pyqt4 - libcups en python-pyqt4 not required?)
-> /usr/share/ppd/HP contains gzipped ppd file, gunzip it.

sudo systemctl enable org.cups.cupsd.service
sudo systemctl start org.cups.cupsd.service

http://localhost:631 -> add printer -> HPLIP -> url from output of: hp-makeuri 192.168.0.25

hp-testpage 192.168.0.25 -g

hp-systray
